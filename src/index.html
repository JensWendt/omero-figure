<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>OMERO.figure</title>

    <script>
      // These are updated by views.py when serving this page
      const BASE_OMEROWEB_URL = "http://localhost:4080/";
      const WEBINDEX_URL = BASE_OMEROWEB_URL + "webclient/";
      const BASE_WEBFIGURE_URL = BASE_OMEROWEB_URL + "figure/";
      const WEBGATEWAYINDEX = BASE_OMEROWEB_URL + "webgateway/";
      const APP_ROOT_URL = "";
      const USER_ID = 0;
      const PING_URL = "";
      const USER_FULL_NAME = "OME";
      // hard-code some units for use with vite...
      const LENGTHUNITS = {
        ANGSTROM: { symbol: "\u00c5", microns: 0.0001 },
        CENTIMETER: { symbol: "cm", microns: 10000.0 },
        KILOMETER: { symbol: "km", microns: 1000000000.0 },
        METER: { symbol: "m", microns: 1000000.0 },
        MICROMETER: { symbol: "\u00b5m", microns: 1 },
        MILLIMETER: { symbol: "mm", microns: 1000.0 },
        NANOMETER: { symbol: "nm", microns: 0.001 },
      };
      // ...this line replaced with full list by views.py
      const LENGTH_UNITS = LENGTHUNITS;
      const IS_PUBLIC_USER = false;
      // Images larger than this are 'big' tiled images
      const MAX_PLANE_SIZE = 10188864;

      const LOCAL_STORAGE_RECOVERED_FIGURE = "recoveredFigure" + USER_ID;
    </script>

    <!-- Use cdn for vite, but this is served from static by Django -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css"
    />
  </head>
  <body>
    <!-- Welcome splash-screen Modal -->
    <div
      class="modal"
      id="welcomeModal"
      tabindex="-1"
      role="dialog"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-hidden="true"
            >
              &times;
            </button>
            <h4 class="modal-title">Welcome to OMERO.figure</h4>
          </div>
          <div class="modal-body" style="padding: 25px 25px 35px 25px">
            <p>To get started...</p>
            <div
              style="
                margin-left: auto;
                margin-right: auto;
                display: block;
                width: 70%;
              "
            >
              <!-- Two buttons - use different elements in different ways -->
              <button type="button" class="new_figure btn btn-lg btn-primary">
                Create New File
              </button>
              <button
                type="button"
                class="open_figure btn btn-lg btn-primary pull-right"
              >
                Open File
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- About OMERO.figure Modal -->
    <div
      class="modal"
      id="aboutModal"
      tabindex="-1"
      role="dialog"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header" style="padding: 15px; text-align: center">
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-hidden="true"
            >
              &times;
            </button>
            <h4 class="modal-title">About OMERO.figure</h4>
          </div>
          <div
            class="modal-body"
            style="padding: 25px 25px 35px 25px; text-align: center"
          >
            <p>
              <strong>Version</strong>:
              <span id="release_version"></span>
            </p>
            <p>
              For more information, visit the
              <a
                target="new"
                href="https://www.openmicroscopy.org/omero/figure/"
                >OMERO.figure Home Page</a
              >
            </p>
            <p>
              &copy; 2013-{% now "Y" %} University of Dundee &amp; Open
              Microscopy Environment<br />
              OMERO is distributed under the terms of the GNU GPL and
              OMERO.figure under AGPL.<br />
              See:
              <a target="new" href="http://www.openmicroscopy.org"
                >openmicroscopy.org</a
              >
            </p>
          </div>
          <div class="modal-footer" style="margin-top: 0">
            <button type="button" class="btn btn-default" data-dismiss="modal">
              Close
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- ROI editing modal dialog -->
    <div
      class="modal"
      id="roiModal"
      data-backdrop="static"
      tabindex="-1"
      role="dialog"
      aria-hidden="true"
    >
      <div class="modal-dialog" style="width: 920px">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title" style="float: left; padding-right: 20px">
              Edit ROIs
            </h4>
            <p style="margin: 4px 0 0 0">
              Draw & edit ROIs and load ROIs from OMERO
            </p>
          </div>
          <form class="roiModalForm" role="form">
            <div class="modal-body">
              <div class="col-xs-8">
                <div
                  id="roi_toolbar"
                  class="roi_toolbar btn-toolbar"
                  role="toolbar"
                  aria-label="..."
                ></div>
                <div id="roiViewer" class="roiViewer">
                  <!-- Show / add ROIs on image -->
                  <!-- <div id="roi_image" style="position: absolute"> -->
                  <img class="roi_image" style="position: absolute" />
                  <!-- </div> -->
                  <div
                    id="roi_paper"
                    class="roi_paper"
                    style="
                      position: absolute;
                      top: 0;
                      left: 0;
                      overflow: hidden;
                    "
                  >
                    <!-- svg is added here by Raphael.js -->
                  </div>

                  <div
                    id="roi_zt_buttons"
                    style="position: absolute; top: 5px; left: 5px"
                  ></div>
                </div>
              </div>
              <div id="roiModalSidebar" class="col-xs-4" style="padding: 0">
                <span
                  id="roiPageControls"
                  style="color: #999; line-height: 30px"
                >
                </span>
                <div style="clear: both; padding: 5px"></div>
                <div style="padding: 0; height: 550px; overflow-y: auto">
                  <div id="roiModalRoiList">
                    <table
                      style="width: 100%"
                      class="table table-hover table-condensed"
                    ></table>
                  </div>
                  <p id="roiModalTip" style="position: absolute; top: 0"></p>
                </div>
              </div>
            </div>
            <div class="modal-footer" style="margin-top: 0">
              <button
                type="button"
                class="btn btn-default"
                data-dismiss="modal"
              >
                Cancel
              </button>
              <button type="submit" class="btn btn-primary">OK</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- Confirm modal for custom messages -->
    <div
      class="modal"
      id="confirmModal"
      data-backdrop="static"
      tabindex="-1"
      role="dialog"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Save Changes to Figure?</h4>
          </div>
          <div class="modal-body" style="padding: 25px 25px 35px 25px">
            <p>Your changes will be lost if you don't save them</p>
          </div>
          <div class="modal-footer" style="margin-top: 0">
            <button type="button" class="btn btn-default" data-dismiss="modal">
              Don't Save
            </button>
            <button type="submit" class="btn btn-primary" data-dismiss="modal">
              Save
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Paper setup Modal -->
    <div
      class="modal"
      id="paperSetupModal"
      tabindex="-1"
      role="dialog"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-hidden="true"
            >
              &times;
            </button>
            <h4 class="modal-title">Paper Setup</h4>
          </div>
          <form class="paperSetupForm" role="form">
            <div class="modal-body">
              <!-- Content added from paper_setup_modal_template -->
            </div>
            <div class="modal-footer" style="margin-top: 0">
              <button
                type="button"
                class="btn btn-default"
                data-dismiss="modal"
              >
                Cancel
              </button>
              <button type="submit" class="btn btn-primary">OK</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- chgrp Modal -->
    <div
      class="modal"
      id="chgrpModal"
      tabindex="-1"
      role="dialog"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-hidden="true"
            >
              &times;
            </button>
            <h4 class="modal-title">Move Figure to Group</h4>
          </div>
          <form class="chgrpForm" role="form">
            <div class="modal-body">
              <!-- Content added -->
            </div>
            <div class="modal-footer" style="margin-top: 0">
              <button
                type="button"
                class="btn btn-default"
                data-dismiss="modal"
              >
                Cancel
              </button>
              <button type="submit" class="btn btn-primary">OK</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- dpi modal -->
    <div
      class="modal"
      id="dpiModal"
      tabindex="-1"
      role="dialog"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-hidden="true"
            >
              &times;
            </button>
            <h4 class="modal-title">Resample Panels</h4>
          </div>
          <form class="dpiModalForm form-horizontal" role="form">
            <div class="modal-body">
              <p>
                Set a resolution range for selected panels. When exported as
                <strong>PDF</strong>, panel images outside this dpi range will
                be resampled as necessary.
              </p>
              <div
                class="form-group"
                style="margin-top: 15px; margin-bottom: 0px"
              >
                <label class="col-sm-4 control-label">
                  Minimum (optional)
                </label>
                <div class="col-sm-8 input-group">
                  <input
                    type="number"
                    class="form-control min_export_dpi"
                    placeholder="min"
                  />
                  <div class="input-group-addon">dpi</div>
                </div>
              </div>
              <div
                class="form-group"
                style="margin-top: 15px; margin-bottom: 0px"
              >
                <label class="col-sm-4 control-label">
                  Maximum (required)
                </label>
                <div class="col-sm-8 input-group">
                  <input
                    type="number"
                    class="form-control max_export_dpi"
                    placeholder="max"
                  />
                  <div class="input-group-addon">dpi</div>
                </div>
              </div>
            </div>
            <div class="modal-footer" style="margin-top: 0">
              <button
                type="button"
                class="btn btn-default"
                data-dismiss="modal"
              >
                Cancel
              </button>
              <button type="submit" class="btn btn-primary">OK</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- Crop Modal -->
    <div
      class="modal"
      id="cropModal"
      tabindex="-1"
      role="dialog"
      aria-hidden="true"
    >
      <div class="modal-dialog" style="width: 900px">
        <div class="modal-content">
          <div class="modal-header">
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-hidden="true"
            >
              &times;
            </button>
            <h4 class="modal-title">Crop to Region</h4>
          </div>
          <form class="cropModalForm" role="form">
            <div
              class="modal-body"
              style="height: 500px; max-height: 500px; padding-bottom: 0"
            >
              <div class="col-xs-4" style="height: 485px; overflow: auto">
                <p>
                  Click and drag on the image to choose a crop region or pick an
                  ROI from the list below.
                </p>
                <h4>ROIs:</h4>
                <table class="roiPicker roisFromFigure table table-condensed">
                  <thead>
                    <td>
                      <strong
                        title="Crop to rectangles on this image in the figure"
                        >from Figure</strong
                      >
                    </td>
                    <td></td>
                    <td></td>
                  </thead>
                  <tbody>
                    <!-- ROIs loaded here... -->
                  </tbody>
                </table>
                <table
                  class="roiPicker roisFromClipboard table table-condensed"
                >
                  <thead>
                    <td>
                      <strong title="Crop to rectangles copied to clipboard"
                        >from Clipboard</strong
                      >
                    </td>
                    <td></td>
                    <td></td>
                  </thead>
                  <tbody>
                    <!-- ROIs loaded here... -->
                  </tbody>
                </table>
                <table class="roiPicker roisFromOMERO table table-condensed">
                  <thead>
                    <td>
                      <strong
                        title="Crop to rectangles saved on this image on the OMERO server"
                        >from OMERO</strong
                      >
                    </td>
                    <td>Z-index</td>
                    <td>T-index</td>
                  </thead>
                  <tbody>
                    <!-- ROIs loaded here... -->
                  </tbody>
                </table>
                <button
                  style="float: right"
                  class="btn btn-sm btn-default loadRoiRects"
                >
                  Load More...
                </button>
                <!-- Additional message/status -->
                <p style="color: #999; margin: 10px" id="cropRoiMessage"></p>
              </div>
              <div class="col-xs-8">
                <div id="cropViewer">
                  <!-- Show / add ROIs on image -->
                  <div
                    id="crop_paper"
                    style="
                      position: absolute;
                      top: 0;
                      left: 0;
                      right: 10px;
                      bottom: 10px;
                      overflow: hidden;
                    "
                  >
                    <!-- svg is added here by Raphael.js -->
                  </div>
                  <img
                    class="crop_image"
                    style="position: absolute; top: 0; left: 0"
                  />
                </div>
              </div>
            </div>
            <div class="modal-footer" style="margin-top: 0">
              <button
                type="button"
                class="btn btn-default"
                data-dismiss="modal"
              >
                Cancel
              </button>
              <button type="submit" class="btn btn-primary" disabled="disabled">
                OK
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- SetId Modal - behaviour handled by SetIdModalView -->
    <div
      class="modal"
      id="setIdModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="setIdLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-hidden="true"
            >
              &times;
            </button>
            <h4 class="modal-title" id="setIdLabel">Edit Image ID</h4>
          </div>
          <div class="modal-body">
            <p>Choose a new Image ID for the selected panels</p>
            <form
              class="setIdForm form-inline"
              role="form"
              style="margin-top: 10px; margin-bottom: 10px"
            >
              <div class="form-group">
                <input
                  type="text"
                  class="form-control imgId"
                  placeholder="Image ID"
                />
              </div>
              <button
                type="submit"
                class="btn btn-primary preview"
                disabled="disabled"
              >
                Preview
              </button>
            </form>
            <div class="previewIdChange"></div>
          </div>
          <div class="modal-footer" style="margin-top: 0">
            <button type="button" class="btn btn-default" data-dismiss="modal">
              Close
            </button>
            <button
              type="submit"
              class="btn btn-primary doSetId"
              data-dismiss="modal"
              disabled="disabled"
            >
              Update
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Color-picker Modal -->
    <div
      class="modal"
      id="colorpickerModal"
      tabindex="-1"
      role="dialog"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-hidden="true"
            >
              &times;
            </button>
            <h4 class="modal-title">Color Picker</h4>
          </div>
          <form class="colorpickerForm" role="form">
            <div class="modal-body">
              <div
                id="demo_cont"
                class="demo demo-auto inl-bl"
                data-container="#demo_cont"
                data-color="#ff0000"
                data-inline="true"
              >
                <div style="position: absolute; left: 280px; top: 200px">
                  <input
                    name="color"
                    style="width: 100px"
                    value="test"
                    class="form-control"
                  />
                </div>
              </div>
              <div class="rgb-group form-horizontal">
                <div class="form-group">
                  <label class="col-sm-4 control-label">Red</label>
                  <div class="col-sm-8">
                    <input
                      type="number"
                      name="red"
                      class="form-control"
                      placeholder="255"
                    />
                  </div>
                </div>
                <div class="form-group">
                  <label class="col-sm-4 control-label">Green</label>
                  <div class="col-sm-8">
                    <input
                      type="number"
                      name="green"
                      class="form-control"
                      placeholder="255"
                    />
                  </div>
                </div>
                <div class="form-group">
                  <label class="col-sm-4 control-label">Blue</label>
                  <div class="col-sm-8">
                    <input
                      type="number"
                      name="blue"
                      class="form-control"
                      placeholder="255"
                    />
                  </div>
                </div>
              </div>
              <ul class="list-group oldNewColors">
                <li class="list-group-item"></li>
                <li class="list-group-item" style="border-top-width: 0"></li>
              </ul>

              <div
                id="pickedColors"
                class="btn-toolbar pickedColors"
                role="toolbar"
              >
                <!-- picked colors added here by render() -->
              </div>
            </div>
            <div class="modal-footer" style="margin-top: 0">
              <button
                type="button"
                class="btn btn-default"
                data-dismiss="modal"
              >
                Cancel
              </button>
              <button type="submit" class="btn btn-primary">OK</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- LUT-picker Modal -->
    <div
      class="modal"
      id="lutpickerModal"
      tabindex="-1"
      role="dialog"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-hidden="true"
            >
              &times;
            </button>
            <h4 class="modal-title">Lookup Table Chooser</h4>
          </div>
          <div class="modal-body" style="height: 500px">
            <p>Loading Lookup Tables...</p>
          </div>
          <div class="lutPreview lutBg">&nbsp</div>
          <div class="modal-footer" style="margin-top: 0">
            <button type="button" class="btn btn-default" data-dismiss="modal">
              Cancel
            </button>
            <button type="submit" class="btn btn-primary" disabled="disabled">
              OK
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Add-Images Modal - behaviour handled by AddImagesModalView -->
    <div
      class="modal"
      id="addImagesModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="addImagesLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-hidden="true"
            >
              &times;
            </button>
            <h4 class="modal-title" id="addImagesLabel">Add Images</h4>
          </div>
          <form class="addImagesForm" role="form">
            <div class="modal-body">
              <p>
                Add images to the figure by entering their IDs, separated by
                commas.<br />
                Hint: You can also select images in the webclient, click the
                link in right panel, copy the URL and paste it here:
              </p>
              <div
                class="form-group"
                style="margin-top: 15px; margin-bottom: 0px"
              >
                <input
                  type="text"
                  class="form-control imgIds"
                  placeholder="Image IDs or URL"
                />
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-default"
                data-dismiss="modal"
              >
                Close
              </button>
              <button
                type="submit"
                class="btn btn-primary"
                data-dismiss="modal"
                disabled="disabled"
              >
                Add Images
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- /.modal -->

    <!-- Export json Modal -->
    <div
      class="modal"
      id="exportJsonModal"
      tabindex="-1"
      role="dialog"
      aria-hidden="true"
    >
      <div class="modal-dialog" style="width: 800px">
        <div class="modal-content">
          <div class="modal-header">
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-hidden="true"
            >
              &times;
            </button>
            <h4 class="modal-title" id="addImagesLabel">Export as JSON</h4>
          </div>
          <form class="addImagesForm" role="form">
            <div class="modal-body">
              <p>
                The current Figure is entirely defined by the JSON data below.
              </p>
              <div
                class="form-group"
                style="margin-top: 15px; margin-bottom: 0px"
              >
                <textarea class="form-control" rows="15"></textarea>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-default"
                data-dismiss="modal"
              >
                Close
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- Import json Modal -->
    <div
      class="modal"
      id="importJsonModal"
      tabindex="-1"
      role="dialog"
      aria-hidden="true"
    >
      <div class="modal-dialog" style="width: 800px">
        <div class="modal-content">
          <div class="modal-header">
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-hidden="true"
            >
              &times;
            </button>
            <h4 class="modal-title" id="addImagesLabel">Import from JSON</h4>
          </div>
          <form class="importJsonForm" role="form">
            <div class="modal-body">
              <p>Paste the JSON data for the Figure into the text box below.</p>
              <div
                class="form-group"
                style="margin-top: 15px; margin-bottom: 0px"
              >
                <textarea class="form-control" rows="15"></textarea>
              </div>
            </div>
            <div class="modal-footer" style="margin-top: 0">
              <button
                type="button"
                class="btn btn-default"
                data-dismiss="modal"
              >
                Cancel
              </button>
              <button type="submit" class="btn btn-primary">OK</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- Markdown Info Modal -->
    <div
      class="modal"
      id="markdownInfoModal"
      tabindex="-1"
      role="dialog"
      aria-hidden="true"
    >
      <div class="modal-dialog" style="width: 800px">
        <div class="modal-content">
          <div class="modal-header">
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-hidden="true"
            >
              &times;
            </button>
            <h4 class="modal-title">Label Formatting</h4>
          </div>
          <div class="modal-body" style="max-height: 518px">
            <h4>Markdown formatting</h4>
            <p>
              You can use "Markdown" syntax to add formatting to plain text. For
              example, **this text will be bold** and this *word* will be
              italic. NB: Links are not supported for panel labels.
            </p>

            <table class="table">
              <tr>
                <td></td>
                <th>This text will be formatted to...</th>
                <th>...this text</th>
              </tr>
              <tr>
                <th>BOLD</th>
                <td>Use 2 stars for **bold**.</td>
                <td>Use 2 stars for <strong>bold</strong>.</td>
              </tr>
              <tr>
                <th>ITALIC</th>
                <td>Use 1 star for *italic*.</td>
                <td>Use 1 star for <i>italic</i>.</td>
              </tr>
              <tr>
                <th>LINKS</th>
                <td>Add links with [Link text](http://link_url.com)</td>
                <td>Add links with <a href="#">Link text</a></td>
              </tr>
              <!--  <tr><td>You need to use 2 line breaks between paragraphs</td><td></td></tr> -->
            </table>
            <h4>Dynamic properties</h4>
            <p>
              The drop-down menu in the 'Add Labels' form allows you to create
              labels based on Image metadata. Labels created with square
              brackets indicate dynamic properties. The properties within the
              square brackets will be dynamically updated upon changes.
              Additional text can be added outside the square brackets and will
              not be affected when the labels are displayed.<br />
              The following table shows some examples, including the use of
              dynamic properties and markdown together.
            </p>
            <table class="table">
              <tr>
                <td></td>
                <th>This text will be formatted to...</th>
                <th>...this text</th>
              </tr>
              <tr></tr>
              <tr>
                <th>X and Y in pixels</th>
                <td>X:[x.pixel] - Y:[y.pixel]</td>
                <td>X:52 - Y:89</td>
              </tr>
              <tr>
                <th>X and Y in units</th>
                <td>X:[x.unit] - Y:[y.unit]</td>
                <td>X:0.43 &#181;m - Y:0.23 &#181;m</td>
              </tr>
              <tr>
                <th>Width</th>
                <td>Width: [width.pixel]</td>
                <td>Width: 400</td>
              </tr>
              <tr>
                <th>Height (with markdown formatting)</th>
                <td>*Height*: **[height.pixel]**</td>
                <td><i>Height</i>: <strong>300</strong></td>
              </tr>
              <tr>
                <th>Image ID</th>
                <td>Image ID: [image.id]</td>
                <td>Image ID: 23556</td>
              </tr>
              <tr>
                <th>Dataset ID</th>
                <td>Dataset ID: [dataset.id]</td>
                <td>Dataset ID: 1654</td>
              </tr>
            </table>
            <h4>Legend</h4>
            <p>
              The figure legend will be included in the PDF info page when the
              figure is exported.
            </p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">
              Close
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- File Open Modal -->
    <div
      class="modal"
      id="openFigureModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="addImagesLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog" style="width: 850px">
        <div class="modal-content">
          <div class="modal-header">
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-hidden="true"
            >
              &times;
            </button>
            <h4 class="modal-title">Open</h4>
          </div>

          <div class="modal-body" style="height: 450px">
            <table class="table table-condensed">
              <thead>
                <tr>
                  <th style="width: 7%"></th>
                  <th style="width: 47%">
                    <form class="form-inline" role="form">
                      <div class="form-group">
                        <label class="col-sm-2 control-label">Name</label>
                      </div>
                      <button
                        type="button"
                        class="btn btn-link btn-sm sort-name muted table-sort-btn"
                      >
                        <span class="glyphicon glyphicon-chevron-up"></span>
                      </button>
                      <button
                        type="button"
                        class="btn btn-link btn-sm sort-name-reverse muted table-sort-btn"
                      >
                        <span class="glyphicon glyphicon-chevron-down"></span>
                      </button>
                      <div class="form-group" style="width: 60%">
                        <input
                          class="form-control"
                          id="file-filter"
                          placeholder="Filter"
                        />
                      </div>
                    </form>
                  </th>
                  <th style="width: 22%">
                    Created
                    <button
                      type="button"
                      class="btn btn-link btn-sm sort-created sort table-sort-btn"
                    >
                      <span class="glyphicon glyphicon-chevron-up"></span>
                    </button>
                    <button
                      type="button"
                      class="btn btn-link btn-sm sort-created-reverse muted table-sort-btn"
                    >
                      <span class="glyphicon glyphicon-chevron-down"></span>
                    </button>
                  </th>
                  <th style="width: 12%">
                    <div class="btn-group" title="Filter files by owner">
                      <button
                        type="button"
                        class="btn btn-default dropdown-toggle"
                        data-toggle="dropdown"
                      >
                        <b>Owner</b> <span class="caret"></span>
                      </button>
                      <ul
                        id="owner-menu"
                        class="dropdown-menu pull-right"
                        role="menu"
                      >
                        <!-- owners added here -->
                      </ul>
                    </div>
                  </th>
                  <th style="width: 12%">
                    <div class="btn-group" title="Filter files by group">
                      <button
                        type="button"
                        class="btn btn-default dropdown-toggle"
                        data-toggle="dropdown"
                      >
                        <b>Group</b> <span class="caret"></span>
                      </button>
                      <ul
                        id="group-menu"
                        class="dropdown-menu pull-right"
                        role="menu"
                      >
                        <!-- groups added here -->
                      </ul>
                    </div>
                  </th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="modal-footer" style="margin-top: 0px">
            <button
              title="Refresh file list"
              type="button"
              class="btn btn-default pull-left refresh-files"
            >
              Refresh
            </button>
            <button type="button" class="btn btn-default" data-dismiss="modal">
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Labels from Map Annotations Modal -->
    <div
      class="modal"
      id="labelsFromMapAnns"
      tabindex="-1"
      role="dialog"
      aria-hidden="true"
    >
      <div class="modal-dialog" style="width: 400px">
        <div class="modal-content">
          <div class="modal-header">
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-hidden="true"
            >
              &times;
            </button>
            <h4 class="modal-title" id="addImagesLabel">
              Labels from Key-Value Pairs
            </h4>
          </div>
          <form class="labelsFromMapAnnsForm" role="form">
            <div class="modal-body">
              <p>
                Choose Key
                <small class="text-muted">(shows numbers of images)</small>:
              </p>
              <select></select>
              <div class="checkbox">
                <label>
                  Include Key in Label
                  <input name="includeKey" type="checkbox" checked />
                </label>
              </div>
              <hr />
              <h5>Example Label</h5>
              <div
                id="exampleLabelFromMap"
                class="well"
                style="background-color: transparent; margin: 0"
              ></div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-default"
                data-dismiss="modal"
              >
                Close
              </button>
              <button type="submit" class="btn btn-primary">OK</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- -- END OF MODAL DIALOGS -- -->

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand text-white" href="#">OMERO</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item dropdown px-2">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                File
              </a>
              <ul class="dropdown-menu">
                <li class="new_figure">
                  <a class="dropdown-item" href="#"> New </a>
                </li>
                <li class="open_figure">
                  <a class="dropdown-item" href="#">
                    <span class="pull-right">Ctrl+O</span>
                    Open...
                  </a>
                </li>
                <li class="save_figure disabled">
                  <a class="dropdown-item" href="#">
                    <span class="pull-right">Ctrl+S</span>
                    Save
                  </a>
                </li>
                <li class="save_as">
                  <a class="dropdown-item" href="#">Save a Copy...</a>
                </li>
                <li
                  class="local_storage"
                  title="Open or Clear recovered data from local storage"
                >
                  <a class="dropdown-item" href="#">Local storage...</a>
                </li>
                <li class="export_json">
                  <a class="dropdown-item" href="#">Export as JSON...</a>
                </li>
                <li class="import_json">
                  <a class="dropdown-item" href="#">Import from JSON...</a>
                </li>
                <li class="delete_figure">
                  <a class="dropdown-item" href="#">Delete</a>
                </li>
                <li class="chgrp_figure">
                  <a class="dropdown-item" href="#">Move Figure to Group...</a>
                </li>
                <li class="paper_setup">
                  <a class="dropdown-item" href="#">Paper Setup...</a>
                </li>
                <!-- Handled by LegendView -->
                <li class="edit-legend">
                  <a class="dropdown-item" href="#">Add Figure Legend...</a>
                </li>
              </ul>
            </li>
            <li class="nav-item dropdown px-2">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                Edit
              </a>
              <ul class="dropdown-menu">
                <li class="undo disabled">
                  <a class="dropdown-item" href="#">
                    <span class="pull-right">Ctrl+Z</span>
                    Undo
                  </a>
                </li>
                <li class="redo disabled">
                  <a class="dropdown-item" href="#">
                    <span class="pull-right">Ctrl+Y</span>
                    Redo
                  </a>
                </li>
                <li class="copy disabled">
                  <a class="dropdown-item" href="#">
                    <span class="pull-right">Ctrl+C</span>
                    Copy
                  </a>
                </li>
                <li class="paste disabled">
                  <a class="dropdown-item" href="#">
                    <span class="pull-right">Ctrl+V</span>
                    Paste
                  </a>
                </li>
              </ul>
            </li>
            <li class="nav-item dropdown px-2">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                Help
              </a>
              <ul class="dropdown-menu">
                <li class="about_figure">
                  <a class="dropdown-item" href="#">About OMERO.figure</a>
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    href="https://www.openmicroscopy.org/omero/figure/"
                    target="new"
                  >
                    Home Page
                  </a>
                </li>
              </ul>
            </li>
          </ul>

          <form class="d-flex">
            <div class="btn-group" style="margin-right: 20px">
              <button
                type="button"
                class="btn btn-sm btn-light"
                data-toggle="modal"
                data-target="#addImagesModal"
                title="Add images to figure"
              >
                Add Image
              </button>
              <button
                type="button"
                class="btn btn-sm btn-light delete_panel"
                title="Delete selected panels"
              >
                Delete
              </button>
            </div>

            <!-- Align-left and Grid buttons in nav bar -->
            <div class="btn-group" style="margin-right: 20px">
              <button
                type="button"
                class="aleft btn btn-sm btn-light"
                title="Align Left"
              >
                <i class="bi-text-left" style="font-size: 1.2rem"></i>
              </button>
              <button
                type="button"
                class="agrid btn btn-sm btn-light delete_panel"
                title="Align To Grid"
              >
                <i class="bi-grid-3x3-gap-fill" style="font-size: 1rem"></i>
              </button>
              <button
                type="button"
                class="btn btn-sm btn-light dropdown-toggle dropdown-toggle-split"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <span class="visually-hidden">Toggle Dropdown</span>
              </button>
              <ul class="dropdown-menu">
                <li>
                  <label
                    ><input
                      type="radio"
                      value="auto"
                      checked
                      name="grid_gap"
                    /><span class="glyphicon glyphicon-ok"> </span> 5% of panel
                    width</label
                  >
                </li>
                <li>
                  <label
                    ><input type="radio" value="0" name="grid_gap" /><span
                      class="glyphicon glyphicon-ok"
                    >
                    </span>
                    0 px (no gap)</label
                  >
                </li>
                <li>
                  <label
                    ><input type="radio" value="1" name="grid_gap" /><span
                      class="glyphicon glyphicon-ok"
                    >
                    </span>
                    1 px</label
                  >
                </li>
                <li>
                  <label
                    ><input type="radio" value="2" name="grid_gap" /><span
                      class="glyphicon glyphicon-ok"
                    >
                    </span>
                    2 px</label
                  >
                </li>
                <li>
                  <label
                    ><input type="radio" value="5" name="grid_gap" /><span
                      class="glyphicon glyphicon-ok"
                    >
                    </span>
                    5 px</label
                  >
                </li>
                <li>
                  <label
                    ><input type="radio" value="10" name="grid_gap" /><span
                      class="glyphicon glyphicon-ok"
                    >
                    </span>
                    10 px</label
                  >
                </li>
                <li>
                  <label
                    ><input type="radio" value="15" name="grid_gap" /><span
                      class="glyphicon glyphicon-ok"
                    >
                    </span>
                    15 px</label
                  >
                </li>
                <li>
                  <label
                    ><input type="radio" value="20" name="grid_gap" /><span
                      class="glyphicon glyphicon-ok"
                    >
                    </span>
                    20 px</label
                  >
                </li>
                <li>
                  <label
                    ><input
                      type="radio"
                      id="custom_grid_gap"
                      value=""
                      name="grid_gap"
                    /><span class="glyphicon glyphicon-ok"> </span> custom
                    <span id="custom_grid_gap_label"></span>
                  </label>
                </li>
              </ul>
            </div>

            <div class="btn-group">
              <button
                type="button"
                disabled
                class="atop btn btn-sm btn-light"
                title="Align Top"
              >
                <i class="bi-text-left" style="font-size: 1.2rem"></i>
              </button>
              <button
                type="button"
                class="btn btn-sm btn-light dropdown-toggle"
                data-bs-toggle="dropdown"
                aria-expanded="false"
                title="Align Sizes"
              >
                <i class="bi-arrows-fullscreen" style="font-size: 1rem"></i>
              </button>
              <ul class="dropdown-menu">
                <li>
                  <a href="#" class="dropdown-item awidth">
                    <i class="bi-justify" style="font-size: 1rem"></i>
                    Align Width</a
                  >
                </li>
                <li>
                  <a href="#" class="dropdown-item aheight">
                    <i class="bi-justify" style="font-size: 1rem"></i>
                    Align Height</a
                  >
                </li>
                <li>
                  <a href="#" class="dropdown-item asize">
                    <i class="bi-arrows-fullscreen" style="font-size: 1rem"></i>
                    Width &amp; Height</a
                  >
                </li>
                <li>
                  <a href="#" class="dropdown-item amagnification">
                    <i class="bi-arrows-fullscreen" style="font-size: 1rem"></i>
                    Align Magnification</a
                  >
                </li>
              </ul>
            </div>

            <!-- Download and Script export buttons -->
            <button type="button" class="btn btn-primary btn-sm">
              Exporting Figure
              <i class="bi-arrow-repeat" style="font-size: 1rem"></i>
            </button>

            <a
              id="pdf_download"
              href="#"
              target="_blank"
              class="btn btn-primary btn-sm"
              ><i class="bi-download"></i
            ></a>

            <button type="button" class="btn btn-danger btn-sm">
              <i class="bi-exclamation-triangle"></i>
            </button>

            <div class="btn-group">
              <button type="button" class="btn btn-success">Export PDF</button>
              <button
                type="button"
                class="btn btn-success dropdown-toggle dropdown-toggle-split"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <span class="visually-hidden">Toggle Dropdown</span>
              </button>
              <ul class="dropdown-menu export_options" role="menu">
                <!-- NB: data-export-option attr used to label export button & handled by js on click -->
                <li>
                  <a
                    class="dropdown-item"
                    href="#"
                    data-export-option="PDF"
                    title="Export figure as PDF"
                  >
                    <i class="bi-check-lg"></i>
                    PDF</a
                  >
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    href="#"
                    data-export-option="PDF & images"
                    title="Export as PDF, in zip with panel images"
                  >
                    <i class="bi-check-lg" style="visibility: hidden"></i>
                    PDF with images</a
                  >
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    href="#"
                    data-export-option="TIFF"
                    title="Export figure as a TIFF image per page"
                  >
                    <i class="bi-check-lg"></i>
                    TIFF (300 dpi)</a
                  >
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    href="#"
                    data-export-option="TIFF & images"
                    title="Export as TIFF, in zip with panel images"
                  >
                    <i class="bi-check-lg"></i>
                    TIFF with images</a
                  >
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    href="#"
                    data-export-option="to OMERO"
                    title="Export each page as an Image in OMERO"
                  >
                    <i class="bi-check-lg"></i>
                    New OMERO Image</a
                  >
                </li>
              </ul>
            </div>
          </form>
        </div>
      </div>
    </nav>

    <main>
      <div id="canvas_wrapper" class="canvas_wrapper">
        <!-- <div id="canvas_overlay"></div> -->
        <article id="canvas">
          <div id="figure">
            <!-- All panels etc are appended to figure. -->
            <!-- We also dynamically add <div class="paper"> -->
          </div>
        </article>
      </div>
    </main>


    <!-- Hacked Bootstrap's modal dialog to be non-modal non-modal-dialog -->
    <div class="modal non-modal-dialog" style="display: block; left:auto">
      <div class="modal-content">
        <ul class="nav nav-tabs" id="myTab" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="info-tab" data-bs-toggle="tab" data-bs-target="#info-tab-pane" type="button" role="tab" aria-controls="info-tab-pane" aria-selected="true">Info</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="preview-tab" data-bs-toggle="tab" data-bs-target="#preview-tab-pane" type="button" role="tab" aria-controls="preview-tab-pane" aria-selected="false">Preview</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#contact-tab-pane" type="button" role="tab" aria-controls="contact-tab-pane" aria-selected="false">Labels</button>
          </li>
        </ul>
        <div class="tab-content" id="myTabContent">
          <div class="tab-pane fade" id="info-tab-pane" role="tabpanel" aria-labelledby="info-tab" tabindex="0">
            Info
          </div>

          <div class="tab-pane fade show active container" id="preview-tab-pane" role="tabpanel" aria-labelledby="preview-tab" tabindex="0">
            <div class="row">
            <div class="col-2 no-padding" id="channelToggle"></div>
            <div class="col-10 no-padding" id="viewportContainer">
              <div id="vp_z_slider" class="pull-left">
                <input type="range" class="z_start" />
                <input type="range" class="z_end" />
                <button
                  type="button"
                  class="btn btn-link btn-sm z-decrement"
                  title="Decrease Z-index"
                >
                  <i class="bi-chevron-down" style="font-size: 1.0rem"></i>
                </button>
                <button
                  type="button"
                  class="btn btn-link btn-sm z-increment"
                  title="Increase Z-index"
                >
                <i class="bi-chevron-up" style="font-size: 1.0rem"></i>
                </button>
              </div>
              <div id="vp_t_slider">
                <input type="range" />
                <button
                  type="button"
                  class="btn btn-link btn-sm time-decrement"
                  title="Decrease T-index"
                >
                  <i class="bi-chevron-left" style="font-size: 1.0rem"></i>
                </button>
                <button
                  type="button"
                  class="btn btn-link btn-sm time-increment"
                  title="Increase T-index"
                >
                  <i class="bi-chevron-right" style="font-size: 1.0rem"></i>
                </button>
              </div>
            </div>
            </div>
            <div class="clearfix" style="padding-bottom: 13px"></div>
            <div id="channel_sliders"></div>
            <div class="clearfix"></div>
            <div class="tab-footer">
              <div class="col-sm-2 no-padding">
                <h5>Zoom</h5>
              </div>
              <div class="col-sm-8 no-padding">
                <div id="vp_zoom_slider"></div>
              </div>
              <div
                id="vp_zoom_value"
                class="col-sm-2"
                style="padding: 8px 0 0; text-align: right"
              ></div>
              <div class="clearfix"></div>
              <div id="reset-zoom-view">
                 <!-- button added by ZoomView render() -->
              </div>
            </div>
          </div>

          <!-- events for this pane handled by LabelsPanelView -->
          <div class="tab-pane fade" id="contact-tab-pane" role="tabpanel" aria-labelledby="contact-tab" tabindex="0">
            <div id="edit_rois_form"></div>

            <div class="clearfix"></div>
            <hr />

            <h5>Scalebar</h5>
            <div id="scalebar_form"></div>

            <hr />

            <h5 style="float: left">Add Labels</h5>

            <button
              type="button"
              class="btn btn-link markdown-info"
              title="Show label formatting options..."
            >
              Tips
            </button>
            <div class="clearfix"></div>
            <form class="new-label-form form-inline" role="form"></form>

            <h5>Edit Labels</h5>
            <div id="selected_panels_labels"></div>
          </div>
        </div>
      </div>
    </div>

    <script type="module" src="./js/main.js"></script>
  </body>
</html>
